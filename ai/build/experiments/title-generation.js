(()=>{"use strict";window.React;const e=window.wp.blockEditor,t=window.wp.compose,n=window.wp.hooks,o=window.wp.plugins,i=window.wp.abilities,r=window.wp.components,l=window.wp.data,s=window.wp.editor,a=window.wp.element,c=window.wp.primitives,u=window.ReactJSXRuntime;var d=(0,u.jsx)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,u.jsx)(c.Path,{d:"m11.3 17.2-5-5c-.1-.1-.1-.3 0-.4l2.3-2.3-1.1-1-2.3 2.3c-.7.7-.7 1.8 0 2.5l5 5H7.5v1.5h5.3v-5.2h-1.5v2.6zm7.5-6.4-5-5h2.7V4.2h-5.2v5.2h1.5V6.8l5 5c.1.1.1.3 0 .4l-2.3 2.3 1.1 1.1 2.3-2.3c.6-.7.6-1.9-.1-2.5z"})});const p=window.wp.i18n,w=window.wp.notices,{aiTitleGenerationData:m}=window;function h({title:e,index:t,onChange:n,onSelect:o}){return(0,u.jsxs)(r.FlexItem,{className:"ai-title",children:[(0,u.jsx)(r.TextareaControl,{rows:2,label:(0,p.__)("Generated title","ai"),hideLabelFromVision:!0,value:e,onChange:n,__nextHasNoMarginBottom:!0}),(0,u.jsx)(r.Button,{variant:"secondary",style:{marginTop:"15px"},onClick:()=>o(e,t),children:(0,p.__)("Select","ai")})]})}function x({titles:e,onTitleChange:t,onSelect:n}){return e&&0!==e.length?(0,u.jsx)(r.Flex,{gap:"5",wrap:!0,direction:"column",children:e.map((o,i)=>(0,u.jsx)(h,{title:o,index:i,onChange:n=>{t(e.map((e,t)=>t===i?n:e))},onSelect:n},`title-${i}`))}):null}function f(){const e=(0,l.select)(s.store).getCurrentPostId(),t=(0,l.select)(s.store).getEditedPostContent(),n=(0,l.select)(s.store).getEditedPostAttribute("title"),{editPost:o}=(0,l.useDispatch)(s.store),[c,h]=(0,a.useState)(!1),[f,g]=(0,a.useState)(!1),[b,v]=(0,a.useState)([]),y=()=>{g(!1),v([])},_=n.trim().length>0?(0,p.__)("Re-generate","ai"):(0,p.__)("Generate","ai");return m?.enabled?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(s.PostTypeSupportCheck,{supportKeys:"title",children:(0,u.jsx)(r.ToolbarGroup,{children:(0,u.jsx)(r.ToolbarButton,{icon:d,label:_,onClick:async()=>{h(!0),(0,l.dispatch)(w.store).removeNotice("ai_title_generation_error");try{const n=await async function(e,t){return(0,i.executeAbility)("ai/title-generation",{content:t,post_id:e}).then(e=>e&&"object"==typeof e&&"titles"in e?e.titles:[]).catch(e=>{throw new Error(`Error generating titles: ${e.message}`)})}(e,t);v(n),g(!0)}catch(e){(0,l.dispatch)(w.store).createErrorNotice(e,{id:"ai_title_generation_error",isDismissible:!0}),v([])}finally{h(!1)}},disabled:c,isBusy:c,children:_})})}),f&&(0,u.jsx)(r.Modal,{title:(0,p.__)("Select a title","ai"),onRequestClose:y,isFullScreen:!1,size:"medium",className:"ai-title-generation-modal",children:b&&(0,u.jsx)(x,{titles:b,onTitleChange:v,onSelect:async e=>{o({title:e}),y()}})})]}):null}function g(e,t,n,o=200){let i=0,r=null;const l=()=>{i<n&&(i++,r=setTimeout(()=>{r=null,e()?t():l()},o))};return()=>{r||l()}}function b(e,t,n=10){return{focus:e,blur:()=>{setTimeout(t,n)}}}function v(e,t,n=!1){const o=n?"focusin":"focus",i=n?"focusout":"blur";return e.addEventListener(o,t.focus),e.addEventListener(i,t.blur),()=>{e.removeEventListener(o,t.focus),e.removeEventListener(i,t.blur)}}const y=(0,t.createHigherOrderComponent)(t=>n=>"core/post-title"!==n.name?(0,u.jsx)(t,{...n}):(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(t,{...n}),(0,u.jsx)(e.BlockControls,{children:(0,u.jsx)(f,{})})]}),"withTitleToolbar");(0,n.addFilter)("editor.BlockEdit","ai/title-generation",y),(0,o.registerPlugin)("ai-title-generation-normal-mode",{render:function(){return(0,a.useEffect)(()=>{let e=!1,t=null,n=null,o=null,i=null,r=null,l=null,s=null;const c=()=>{const e=document.querySelector('iframe[name="editor-canvas"], iframe.wp-block-editor-iframe__iframe');return e&&e.contentDocument?e.contentDocument:null},d=()=>{l&&(l.style.display="flex")},p=()=>{(()=>{const e=c();if(!e)return!1;const t=e.activeElement;return!(!t||t!==r&&!r?.contains(t)&&(!l||t!==l&&!l.contains(t)&&!l.querySelector(".components-dropdown-menu .is-opened")))})()?d():l&&(l.style.display="none")},w=()=>{if(e)return;const i=c();if(!i)return void g(()=>null!==c(),w,20)();if(i.querySelector(".ai-title-toolbar-wrapper"))return void(e=!0);const m=[".editor-post-title__input"];let h=null;for(const e of m)if(h=i.querySelector(e),h)break;if(!h)return void g(()=>{const e=c();return!!e&&!!e.querySelector(".editor-post-title__input")},w,10)();if(r=h,r.closest(".ai-title-toolbar-wrapper"))return void(e=!0);const x=r.parentElement;if(!x)return;const y=r.nextSibling;s=i.createElement("div"),s.className="ai-title-toolbar-wrapper",s.style.cssText="position: relative;",l=i.createElement("div"),l.className="ai-title-toolbar-container",l.style.cssText="display: none; position: absolute; z-index: 1000; top: -60px;",s.appendChild(l),s.appendChild(r),x.insertBefore(s,y),t=(0,a.createRoot)(l),t.render((0,u.jsx)(f,{}));const _=b(d,p);n=v(r,_);const j=b(d,p);o=v(l,j,!0),i.activeElement===r&&d(),e=!0},m=setTimeout(()=>{w()},100),h=setTimeout(()=>{const t=c();t&&!i&&(i=new MutationObserver((n,o)=>{e||t.querySelector(".ai-title-toolbar-wrapper")?e&&o.disconnect():w()}),i.observe(t.body,{childList:!0,subtree:!0}))},500);return()=>{i&&i.disconnect(),clearTimeout(m),clearTimeout(h),n&&n(),o&&o(),t&&t.unmount(),s?s.remove():l&&l.remove()}},[]),(0,u.jsx)(u.Fragment,{})}})})();